name: Update homebrew tap formula

on:
  workflow_run:
    workflows: ["Upload rust binary"]
    types:
      - completed

jobs:
    homebrew:
      name: Bump Homebrew formula
      runs-on: ubuntu-latest
      steps:
        - name: Extract version
          id: extract-version
          run: |
            printf "::set-output name=%s::%s\n" tag-name "${GITHUB_REF#refs/tags/}"
        - uses: mislav/bump-homebrew-formula-action@v2
          if: ${{ !contains(github.ref, '-') }} # skip prereleases
          with:
            formula-name: scraps
            formula-path: Formula/scraps.rb
            homebrew-tap: boykush/homebrew-tap
            base-branch: main
            download-url: https://github.com/boykush/scraps/releases/download/${{ steps.extract-version.outputs.tag-name }}/scraps_${{ steps.extract-version.outputs.tag-name }}_x86_64-apple-darwin.tar.gz
            commit-message: |
              {{formulaName}} {{version}}
  
              Created by https://github.com/mislav/bump-homebrew-formula-action
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}